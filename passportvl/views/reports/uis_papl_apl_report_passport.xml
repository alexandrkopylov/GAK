<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
<template id="passportvl.uis_papl_apl_report_passport">
    <t t-call="report.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="report.external_layout">
                <div class="page" name="blocks">
                <div name="main_passport"> <!--class="page" !-->
                    <style type="text/css">
                        .report-field{
                        border-bottom: 1px solid black;
                        }
                    </style>
                    <p class="text-center">
                    <br/><br/>
                    <div class="row">
                        <div class="col-xs-8"/>
                        <div class="col-xs-4">
                            Locality:<span t-field="o.locality"/><br/>
                            Department:<span t-field="o.department_id"/><br/>
                            Substation:<span t-field="o.sup_substation_id"/><br/>
                            Date:<span t-esc="time.strftime('%d.%m.%Y')"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            <h1><br/><br/><br/>Passport VL</h1><br/>
                            <h2>Name of air power line:<br/>
                            <span t-field="o.name"/></h2><br/><br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4"/>
                        <div class="col-xs-4 text-center">
                        <img t-att-src="'https://api.qrserver.com/v1/create-qr-code/?data=http://app.uisgis.ru%s' % o.url_maps"/>        
                        </div>
                        <div class="col-xs-4"/>
                    </div>
                    
                    <br/>
                    <br/>
                    <div class="row">
                        <div class="col-xs-4"/>
                        <div class="col-xs-4 text-center">
                            <span t-esc="time.strftime('%d.%m.%Y')"/>
                        </div>
                    </div>
                    </p>
                    <!--<img t-att-src="'/report/barcode/QR/%s' % 'http://demo.uisgis.ru:8069/apl_id'"/>!-->
                    <p style="page-break-after:always;">
                    <div class="row">
                        <div class="col-xs-4">
                            <strong>Name of APL:</strong><br/>
                        </div>
                        <div class="col-xs-8 report-field">
                            <span t-field="o.name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            Year of building
                        </div>
                        <div class="col-xs-8 report-field">
                            <span t-field="o.bld_year"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            Start-up date
                        </div>
                        <div class="col-xs-8 report-field">
                            <span t-field="o.startexp_date"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            Inventory number
                        </div>
                        <div class="col-xs-8 report-field">
                            <span t-field="o.inv_num"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            Installation company
                        </div>
                        <div class="col-xs-8 report-field">
                            <span t-field="o.build_company"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            <h3>I. The circuit schematic</h3>
                        </div>
                        <div class="col-xs-12 text-center">
                            <!--<img src="/passportvl/static/src/img/scheme_example.png"/>
                            <img t-att-src="o.scheme_image"/>!-->
                            <span t-field="o.scheme_image" t-field-options="{&quot;widget&quot;:&quot;image&quot;}"/>
                        </div>
                    </div>
                    <p style="page-break-after:always;"/>
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            <h3>II. Main details</h3>
                        </div>
                        <div class="col-xs-12 text-center">
                            <h4>1. General characteristics</h4>
                        </div>
                    </div>
                    <div class="row" >
                        <div class="col-xs-6">
                            <div class="row">
                                <div class="col-xs-6">
                                    1. Lenght (km):
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-field="o.line_len"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    1(a). Lenght calculated (m):
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-field="o.line_len_calc"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    2. Span lenght (m):
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Maximum (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.prol_max_len"/></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Medium (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.prol_med_len"/></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Minimum (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.prol_min_len"/></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    3. Cable:
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-foreach="o.cable_ids" t-as="c">
                                        <span t-field="c.name"/>;
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    4. Sag (m):
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Maximum (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.sag_max"/></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Medium (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.sag_med"/></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2"/>
                                <div class="col-xs-6 text-left">Minimum (m):</div>
                                <div class="col-xs-4 text-center report-field"><span t-field="o.sag_min"/></div>
                            </div>
                        </div>
                        <div class="col-xs-6" style="border-left:1px solid black;">
                            <div class="row">
                                <div class="col-xs-6">
                                    5. Number of circuits:
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-field="o.count_circ"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    6. Climatic conditions:
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-field="o.climatic_conditions"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    7. Switching point:
                                </div>
                                <div class="col-xs-6 text-center report-field">
                                    <span t-field="o.sw_point"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    8. Taps:
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 text-justify">
                                    <span t-field="o.tap_text"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <br/>
                        <div class="col-xs-12 text-center">
                            <h4>2. Pillars</h4>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6" style="border-right:1px solid black;">
                            <div class="row" style="border-bottom:2px solid black; font-weight:bold;">
                                <div class="col-xs-4 text-center">Type</div>
                                <div class="col-xs-2 text-center">Qnty</div>
                                <div class="col-xs-6 text-center">Numbers of pillars</div>
                            </div>
                            <t t-foreach="o.apl_pil_type_ids" t-as="apt">
                                <div class="row" style="border-bottom:1px dashed black;">
                                    <div class="col-xs-4 text-center"><span t-field="apt.pillar_type_id.name"/></div>
                                    <div class="col-xs-2 text-center"><span t-field="apt.cnt"/></div>
                                    <div class="col-xs-6"><span t-field="apt.numbers"/></div>
                                </div>    
                            </t>
                        </div>
                        <div class="col-xs-6" style="border-left:1px solid black;">
                            <div class="row" style="border-bottom:2px solid black; font-weight:bold;">
                                <div class="col-xs-4 text-center">Material</div>
                                <div class="col-xs-2 text-center">Qnty</div>
                                <div class="col-xs-6 text-center">Numbers of pillars</div>
                            </div>
                            <t t-foreach="o.apl_pil_material_ids" t-as="apm">
                                <div class="row" style="border-bottom:1px dashed black;">
                                    <div class="col-xs-4 text-center"><span t-field="apm.pillar_material_id.name"/></div>
                                    <div class="col-xs-2 text-center"><span t-field="apm.cnt"/></div>
                                    <div class="col-xs-6"><span t-field="apm.numbers"/></div>
                                </div>    
                            </t>
                        </div>    
                    </div>
                    <br/>
                    <div class="row">
                        <div class="row" style="border-bottom:2px solid black;">
                            <div class="col-xs-2 text-center">Name</div>
                            <div class="col-xs-2 text-center">Number of tap</div>
                            <div class="col-xs-2 text-center">Number</div>
                            <div class="col-xs-2 text-center">Type</div>
                            <div class="col-xs-2 text-center">Material</div>
                            <div class="col-xs-2 text-center">Cut</div>
                        </div>
                        <t t-foreach="o.pillar_id.sorted(key=lambda r:str(r.tap_id.id).zfill(3)+'_'+str(r.num_by_vl).zfill(3), reverse=False)" t-as="pil">
                            <div class="row" style="border-bottom:1px dashed black;">
                                <div class="col-xs-2 text-center"><span t-field="pil.name"/></div>
                                <div class="col-xs-2 text-center"><span t-field="pil.tap_id.num_by_vl"/></div>
                                <div class="col-xs-2 text-center"><span t-field="pil.num_by_vl"/></div>
                                <div class="col-xs-2 text-center"><span t-field="pil.pillar_type_id.name"/></div>
                                <div class="col-xs-2 text-center"><span t-field="pil.pillar_material_id.name"/></div>
                                <div class="col-xs-2 text-center"><span t-field="pil.pillar_cut_id.name"/></div>
                            </div>
                        </t>
                    </div>
                    
                    
                   
                    <div class="row">
                        <br/>
                        <div class="col-xs-12 text-center">
                            <h4>3. Resistance</h4>
                        </div>
                    </div>
                    <div class="row" style="border-bottom:2px solid black; font-weight:bold;">
                        <div class="col-xs-3 text-center">Cable type</div>
                        <div class="col-xs-3 text-center">Resistivity</div>
                        <div class="col-xs-3 text-center">Length</div>
                        <div class="col-xs-3 text-center">Total resistance</div>
                    </div>
                    <t t-foreach="o.resistance_ids" t-as="aplres">
                        <div class="row" style="border-bottom:1px dashed black;">
                            <div class="col-xs-3 text-center"><span t-field="aplres.cable_id.name"/></div>
                            <div class="col-xs-3 text-center"><span t-field="aplres.resistivity"/></div>
                            <div class="col-xs-3 text-center"><span t-field="aplres.length"/></div>
                            <div class="col-xs-3 text-center"><span t-field="aplres.total_resistance"/></div>
                        </div>
                    </t>
                    <div class="row">
                        <br/>
                        <div class="col-xs-12 text-center">
                            <h4>4. Main line / taps</h4>
                        </div>
                    </div>
                    <div class="row" style="border-bottom:2px solid black; font-weight:bold;">
                        <div class="col-xs-3 text-center">Name</div>
                        <div class="col-xs-3 text-center">Connected pillar</div>
                        <div class="col-xs-3 text-center">Pillar count</div>
                        <div class="col-xs-3 text-center">Line length</div>
                    </div>
                    <t t-foreach="o.tap_ids" t-as="tap">
                        <div class="row" style="border-bottom:1px dashed grey;">
                            <div class="col-xs-3 text-center"><span t-field="tap.name"/></div>
                            <div class="col-xs-3 text-center"><span t-field="tap.conn_pillar_id.name"/></div>
                            <div class="col-xs-3 text-center"><span t-field="tap.pillar_cnt"/></div>
                            <div class="col-xs-3 text-center"><span t-field="tap.line_len_calc"/></div>
                        </div>
                        <div class="row" style="border-bottom:1px solid black;">
                            <div class="col-xs-6">
                                <span t-field="tap.profile_image" t-field-options='{"widget":"image"}'/>
                            </div>
                            <div class="col-xs-6">
                                <span t-field="tap.profile_3d_image" t-field-options='{"widget":"image"}'/>
                            </div>     	
                        </div>
                    </t>
                    <div class="row">
                        <br/>
                        <div class="col-xs-12 text-center">
                            <h4>5.Fittings</h4>
                        </div>
                    </div>
                    <div class="row" style="border-bottom:2px solid black; font-weight:bold;">
                        <div class="col-xs-3 text-center">Fitting class</div>
                        <div class="col-xs-3 text-center">Fitting name</div>
                        <div class="col-xs-1 text-center">Fitting type</div>
                        <div class="col-xs-1 text-center">Quantity</div>
                        <div class="col-xs-4">Comment</div>
                    </div>
                    <t t-foreach="o.fitting_ids" t-as="fit">
                        <div class="row" style="border-bottom:1px dashed black;">
                            <div class="col-xs-3 text-center"><span t-field="fit.class_id.name"/></div>
                            <div class="col-xs-3 text-center"><span t-field="fit.fitting_name"/></div>
                            <div class="col-xs-1 text-center"><span t-field="fit.fitting_type"/></div>
                            <div class="col-xs-1 text-center"><span t-field="fit.qnt"/></div>
                            <div class="col-xs-4"><span t-field="fit.comment"/></div>
                        </div>
                    </t>
                    </p>
                </div>
                </div>
            </t>
        </t>
    </t>
</template>
</data>
</openerp>